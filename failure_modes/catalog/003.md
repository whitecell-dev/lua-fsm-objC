================================================================
CALYX FSM MAILBOX DEMO: Producer-Consumer Pattern
================================================================

=== PHASE 1: Producer generates and sends data ===

[TRACE BEFORE] fsm=PRODUCER event=start from=IDLE to=GENERATING data.dataset_name=financial_report_Q4.csv options.consumer_fsm=table: 0x55ce713a7ea0
[PRODUCER] Starting data generation for: financial_report_Q4.csv
[TRACE ENTER] fsm=PRODUCER event=start from=IDLE to=GENERATING data.dataset_name=financial_report_Q4.csv options.consumer_fsm=table: 0x55ce713a7ea0
[TRACE AFTER] fsm=PRODUCER event=start from=IDLE to=GENERATING data.dataset_name=financial_report_Q4.csv options.consumer_fsm=table: 0x55ce713a7ea0
[PRODUCER] State: IDLE -> GENERATING
[TRACE BEFORE] fsm=PRODUCER event=generated from=GENERATING to=SENDING
[PRODUCER] Generating data...
[PRODUCER] Data generation complete
[TRACE ENTER] fsm=PRODUCER event=generated from=GENERATING to=SENDING
[TRACE AFTER] fsm=PRODUCER event=generated from=GENERATING to=SENDING
[PRODUCER] State: GENERATING -> SENDING
[TRACE BEFORE] fsm=PRODUCER event=sent from=SENDING to=WAITING options.consumer_fsm=table: 0x55ce713a7ea0
[PRODUCER] Sending data to CONSUMER...
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[TRACE ENTER] fsm=PRODUCER event=sent from=SENDING to=WAITING options.consumer_fsm=table: 0x55ce713a7ea0
[TRACE AFTER] fsm=PRODUCER event=sent from=SENDING to=WAITING options.consumer_fsm=table: 0x55ce713a7ea0
[PRODUCER] State: SENDING -> WAITING

=== PHASE 2: Consumer processes mailbox ===


[21:15:16] Processing mailbox for CONSUMER (1 messages)
[21:15:16] Processing message: receive from PRODUCER
[TRACE BEFORE] fsm=CONSUMER event=receive from=IDLE to=VALIDATING data.records=1000 data.format=csv
[CONSUMER] Received dataset: unknown (1000 records)
[TRACE ENTER] fsm=CONSUMER event=receive from=IDLE to=VALIDATING data.records=1000 data.format=csv
[TRACE AFTER] fsm=CONSUMER event=receive from=IDLE to=VALIDATING data.records=1000 data.format=csv
[CONSUMER] State: IDLE -> VALIDATING
[21:15:16] Mailbox processing complete: 1 messages processed

[TRACE BEFORE] fsm=CONSUMER event=validated from=VALIDATING to=PROCESSING
[CONSUMER] Validating data...
[CONSUMER] Validation complete
[TRACE ENTER] fsm=CONSUMER event=validated from=VALIDATING to=PROCESSING
[TRACE AFTER] fsm=CONSUMER event=validated from=VALIDATING to=PROCESSING
[CONSUMER] State: VALIDATING -> PROCESSING
[TRACE BEFORE] fsm=CONSUMER event=processed from=PROCESSING to=ACKNOWLEDGING
[CONSUMER] Processing data...
[CONSUMER] Processing complete
[TRACE ENTER] fsm=CONSUMER event=processed from=PROCESSING to=ACKNOWLEDGING
[TRACE AFTER] fsm=CONSUMER event=processed from=PROCESSING to=ACKNOWLEDGING
[CONSUMER] State: PROCESSING -> ACKNOWLEDGING
[TRACE BEFORE] fsm=CONSUMER event=acknowledged from=ACKNOWLEDGING to=IDLE options.producer_fsm=table: 0x55ce713a6c00
[CONSUMER] Sending acknowledgment to PRODUCER...
[MAILBOX] Enqueued message: event=acknowledged from=CONSUMER to=PRODUCER
[TRACE ENTER] fsm=CONSUMER event=acknowledged from=ACKNOWLEDGING to=IDLE options.producer_fsm=table: 0x55ce713a6c00
[TRACE AFTER] fsm=CONSUMER event=acknowledged from=ACKNOWLEDGING to=IDLE options.producer_fsm=table: 0x55ce713a6c00
[CONSUMER] State: ACKNOWLEDGING -> IDLE

=== PHASE 3: Producer processes acknowledgment ===


[21:15:19] Processing mailbox for PRODUCER (1 messages)
[21:15:19] Processing message: acknowledged from CONSUMER
[TRACE BEFORE] fsm=PRODUCER event=acknowledged from=WAITING to=IDLE data.status=success
[TRACE ENTER] fsm=PRODUCER event=acknowledged from=WAITING to=IDLE data.status=success
[TRACE AFTER] fsm=PRODUCER event=acknowledged from=WAITING to=IDLE data.status=success
[PRODUCER] State: WAITING -> IDLE
[21:15:19] Mailbox processing complete: 1 messages processed


=== FINAL STATE ===
PRODUCER: IDLE (mailbox: 0 messages)
CONSUMER: IDLE (mailbox: 0 messages)


================================================================
DEMO 2: PING-PONG FSM COMMUNICATION
================================================================

=== Starting Ping-Pong Exchange ===

[TRACE BEFORE] fsm=PING event=ping from=READY to=WAITING data.count=1 options.pong_fsm=table: 0x55ce713b20f0
[PING] Sending ping #1
[MAILBOX] Enqueued message: event=pong from=PING to=PONG
[TRACE ENTER] fsm=PING event=ping from=READY to=WAITING data.count=1 options.pong_fsm=table: 0x55ce713b20f0
[TRACE AFTER] fsm=PING event=ping from=READY to=WAITING data.count=1 options.pong_fsm=table: 0x55ce713b20f0

--- Round 1 ---

[21:15:19] Processing mailbox for PONG (1 messages)
[21:15:19] Processing message: pong from PING
[TRACE BEFORE] fsm=PONG event=pong from=READY to=WAITING data.count=1
[PONG] Received ping #1
[TRACE ENTER] fsm=PONG event=pong from=READY to=WAITING data.count=1
[TRACE AFTER] fsm=PONG event=pong from=READY to=WAITING data.count=1
[21:15:19] Mailbox processing complete: 1 messages processed


[21:15:19] Processing mailbox for PING (0 messages)
[21:15:19] Mailbox processing complete: 0 messages processed

[TRACE BEFORE] fsm=PONG event=ping from=WAITING to=READY options.ping_fsm=table: 0x55ce713b12e0
[PONG] Sent pong #1
[TRACE ENTER] fsm=PONG event=ping from=WAITING to=READY options.ping_fsm=table: 0x55ce713b12e0
[TRACE AFTER] fsm=PONG event=ping from=WAITING to=READY options.ping_fsm=table: 0x55ce713b12e0
[TRACE BEFORE] fsm=PING event=pong from=WAITING to=READY data.count=1 options.pong_fsm=table: 0x55ce713b20f0
[PING] Received pong #1
[MAILBOX] Enqueued message: event=ping from=PING to=PING
[TRACE ENTER] fsm=PING event=pong from=WAITING to=READY data.count=1 options.pong_fsm=table: 0x55ce713b20f0
[TRACE AFTER] fsm=PING event=pong from=WAITING to=READY data.count=1 options.pong_fsm=table: 0x55ce713b20f0

--- Round 2 ---

[21:15:19] Processing mailbox for PONG (0 messages)
[21:15:19] Mailbox processing complete: 0 messages processed


[21:15:19] Processing mailbox for PING (1 messages)
[21:15:19] Processing message: ping from PING
[TRACE BEFORE] fsm=PING event=ping from=READY to=WAITING data.count=2
[PING] Sending ping #2
[TRACE ENTER] fsm=PING event=ping from=READY to=WAITING data.count=2
[TRACE AFTER] fsm=PING event=ping from=READY to=WAITING data.count=2
[21:15:19] Mailbox processing complete: 1 messages processed

[TRACE BEFORE] fsm=PING event=pong from=WAITING to=READY data.count=2 options.pong_fsm=table: 0x55ce713b20f0
[PING] Received pong #2
[MAILBOX] Enqueued message: event=ping from=PING to=PING
[TRACE ENTER] fsm=PING event=pong from=WAITING to=READY data.count=2 options.pong_fsm=table: 0x55ce713b20f0
[TRACE AFTER] fsm=PING event=pong from=WAITING to=READY data.count=2 options.pong_fsm=table: 0x55ce713b20f0

--- Round 3 ---

[21:15:19] Processing mailbox for PONG (0 messages)
[21:15:19] Mailbox processing complete: 0 messages processed


[21:15:19] Processing mailbox for PING (1 messages)
[21:15:19] Processing message: ping from PING
[TRACE BEFORE] fsm=PING event=ping from=READY to=WAITING data.count=3
[PING] Sending ping #3
[TRACE ENTER] fsm=PING event=ping from=READY to=WAITING data.count=3
[TRACE AFTER] fsm=PING event=ping from=READY to=WAITING data.count=3
[21:15:19] Mailbox processing complete: 1 messages processed

[TRACE BEFORE] fsm=PING event=pong from=WAITING to=READY data.count=3 options.pong_fsm=table: 0x55ce713b20f0
[PING] Received pong #3
[TRACE ENTER] fsm=PING event=pong from=WAITING to=READY data.count=3 options.pong_fsm=table: 0x55ce713b20f0
[TRACE AFTER] fsm=PING event=pong from=WAITING to=READY data.count=3 options.pong_fsm=table: 0x55ce713b20f0

=== Ping-Pong Complete ===
PING FSM: READY (mailbox: 0)
PONG FSM: READY (mailbox: 0)

================================================================
DEMO COMPLETE
================================================================
[BREAKAGE TEST] Initializing FSMs for producer state failure test...

[BREAKAGE TEST] --- PHASE 1: FIRST BATCH ---
[METRIC] Producer state before: IDLE
[METRIC] Consumer mailbox count before: 0
[TRACE BEFORE] fsm=PRODUCER event=send_batch from=IDLE to=IDLE data.count=100
[PRODUCER] Callback triggered to send 100 messages.
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[MAILBOX] Enqueued message: event=receive from=PRODUCER to=CONSUMER
[METRIC] Producer state after: IDLE
[METRIC] Consumer mailbox count after batch 1: 100

[BREAKAGE TEST] --- PHASE 2: SECOND BATCH ---
[METRIC] Producer state before: IDLE
[METRIC] Producer state after: IDLE
[METRIC] Consumer mailbox count after batch 2: 100

[BREAKAGE TEST] --- RESULTS ---
[RESULT] REPRODUCED: Producer failed to send the second batch of messages.
[ANALYSIS] The mailbox count did not increase after the second send_batch call.

[BREAKAGE TEST] Test complete.
